<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADSEUM - Empowering Queer Art</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <style>
        body {
            font-family: 'Courier New', Courier, monospace;
        }

        /* Fallback font */
    </style>
</head>

<body class="bg-[#FDFDFD] overflow-hidden w-screen h-screen flex flex-col justify-center items-center relative">

    <!-- Background Blobs -->
    <div class="absolute inset-0 z-0 pointer-events-none overflow-hidden">
        <!-- Pink Blob -->
        <div class="blob absolute top-[-10%] left-[-10%] w-[50vw] h-[50vw] bg-pink-300/30 blur-[100px] rounded-full">
        </div>
        <!-- Yellow Blob -->
        <div
            class="blob absolute bottom-[-10%] right-[-10%] w-[60vw] h-[60vw] bg-yellow-200/40 blur-[120px] rounded-full">
        </div>
        <!-- Blue Blob -->
        <div class="blob absolute top-[20%] right-[10%] w-[40vw] h-[40vw] bg-blue-200/30 blur-[80px] rounded-full">
        </div>
    </div>

    <!-- Logo Container -->
    <div id="logo-grid" class="relative z-10 flex p-4">
        <!-- Generated by JS -->
    </div>

    <!-- Subtitle -->
    <div class="absolute bottom-10 z-10 opacity-0 subtitle-anim">
        <p class="text-gray-500 tracking-[0.3em] text-sm md:text-base font-bold uppercase">Empowering Queer Art</p>
    </div>

    <script src="letters.js"></script>
    <script type="module" src="script.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // 1. Initial Render (Defaults)
            if (typeof renderText === 'function') {
                renderText('logo-grid', 'ADseum');
            }

            // Delay initial animation slightly to avoid race condition with fast fetch (glitch)
            window.startupAnimTimeout = setTimeout(() => {
                if (typeof initAnimations === 'function') {
                    initAnimations();
                }
                window.startupAnimTimeout = null; // Mark as run
            }, 300);
        });
    </script>

    <script type="module">
        import { db } from './firebase-config.js';
        import { collection, getDocs } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";

        // 2. Fetch Updates
        (async function () {
            try {
                const querySnapshot = await getDocs(collection(db, "letters"));
                let hasUpdates = false;
                querySnapshot.forEach((doc) => {
                    // Update global letters
                    const data = doc.data();
                    if (data.gridData) {
                        const reconstructedGrid = [];
                        for (let i = 0; i < data.rows; i++) {
                            reconstructedGrid.push(data.gridData[`row${i}`]);
                        }
                        window.letters[doc.id] = reconstructedGrid;
                    } else if (data.grid) {
                        // Legacy support
                        window.letters[doc.id] = data.grid;
                    }
                    hasUpdates = true;
                });

                if (hasUpdates) {
                    // Check if initial animation is pending (Fast Fetch)
                    let isFastFetch = false;
                    if (window.startupAnimTimeout) {
                        clearTimeout(window.startupAnimTimeout);
                        window.startupAnimTimeout = null;
                        isFastFetch = true;
                    }

                    // Always re-render with new data
                    const container = document.getElementById('logo-grid');
                    if (container) {
                        container.innerHTML = '';
                        renderText('logo-grid', 'ADseum');

                        if (isFastFetch) {
                            // First time running animations (avoid glitch)
                            if (typeof initAnimations === 'function') {
                                initAnimations();
                            }
                        } else {
                            // Update existing animations (slow fetch or subsequent update)
                            if (window.updateWiggleTargets) {
                                window.updateWiggleTargets();
                            }
                            // Re-trigger entrance animation
                            if (typeof animateDots === 'function') {
                                animateDots();
                            }
                        }
                    }
                }
            } catch (e) {
                console.error("Error loading letters (likely offline/CORS):", e);
            }
        })();
    </script>
</body>

</html>